# L2TP_IPsec_VPN_setup
Это руководство поможет настроить VPN-подключение через L2TP/IPsec на Arch Linux.
## Основные понятия

### IPsec (Internet Protocol Security)
- Защищает данные на сетевом уровне
- Обеспечивает шифрование и аутентификацию
- Использует общий ключ (PSK) для установления безопасного соединения

### L2TP (Layer 2 Tunneling Protocol)
- Создает туннель для передачи данных
- Не обеспечивает шифрование (поэтому используется с IPsec)
- Работает поверх UDP порта 1701

### PPP (Point-to-Point Protocol)
- Управляет соединением "точка-точка"
- Обрабатывает аутентификацию пользователя (логин/пароль)
- Назначает IP-адрес

## Предварительные требования
- Arch Linux (обновленная система)
- Права root для установки пакетов

## Установка

1. Установите необходимые пакеты:
```bash
sudo pacman -S strongswan xl2tpd ppp
```

2.Склонируйте репозиторий:
```bash
git clone https://github.com/L2TP_IPsec_VPN_setup.git
```

3.Запустите скрипт установки:
```bash
sudo ./install.sh
```
## Конфигурация

### Основные настройки:

Пример:
VPN-сервер:	115.91.84.181
Тип подключения:	L2TP/IPsec
Общий ключ:	$omE%Key!
Пользователь: user
Пароль: password

Все файлы конфигурации находятся в /etc/vpn-org/

## Инструкция по использованию:
1. Скопируйте все файлы в структуру каталогов как показано выше
2. Сделайте install.sh исполняемым:
```bash
chmod +x install.sh
```
3. Запустите установку:
```bash
sudo ./install.sh
```

3. Подключение к VPN:
```bash
sudo connect-vpn
```

4. Отключение от VPN:
```bash
sudo disconnect-vpn
```
5. Проверка состояния:
```bash
sudo ipsec status
ip a show dev ppp0
```
После подключения должны быть доступны внутрненние ресурсы организации. Не забудьте прописать nameserver в /etc/resolv.conf, предварительно узнав ip DNS сервера у администратора.

## Устранение неполадок

1. Проверьте службы:
```bash
systemctl status strongswan
systemctl status xl2tpd
```
2. Просмотрите логи:
```bash
journalctl -u strongswan -f
journalctl -u xl2tpd -f
```
3. Проверьте порты:
```bash
sudo ss -tuln | grep -E '500|4500|1701'
```
4. Тестирование соединения:
```bash
ping 192.168.0.10 # внутренний ресурс удаленной организации
curl -v http://192.168.0.10
```
## Особенности реализации

1. Все конфигурации изолированы в /etc/vpn-org/
2. Используются симлинки для интеграции с systemd
3. Скрипты имеют простые имена для удобства
4. Автоматическое добавление маршрута к внутренней сети
5. Подробное логгирование на всех этапах




