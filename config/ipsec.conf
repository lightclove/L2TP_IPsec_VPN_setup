# Файл ipsec.conf — это основной конфигурационный файл для strongSwan (реализация IPsec), # который определяет параметры безопасного соединения. Разберём его содержимое подробно:
# Ключевые особенности:
# Совместимость с L2TP:
# Настройки оптимизированы для работы с L2TP (порт 1701/UDP, IKEv1).
#
# Безопасность:
# Используются современные алгоритмы (AES-256) с длиной ключа 256 бит.
#
# Производительность:
# modp1024 (DH group 2) обеспечивает баланс между безопасностью и скоростью.
#
# Декларативный подход:
# Чёткое разделение общих настроек (%default) и специфичных для соединения (org-vpn).
#
# Почему именно так?
# Transport mode вместо Tunnel mode:
# Требуется для сквозного шифрования L2TP-трафика без изменения IP-заголовков.
#
# Жёстко заданные алгоритмы:
# Гарантируют совместимость с большинством корпоративных VPN-серверов.
#
# Автозагрузка без автозапуска (auto=add):
# Позволяет контролировать подключение через скрипты.
#
# Как это работает в связке?
# strongSwan устанавливает защищённый IPsec-канал
#
# xl2tpd создаёт L2TP-туннель поверх IPsec
#
# PPP поверх L2TP управляет аутентификацией пользователя
#
# Файл критически важен для первой фазы подключения (шифрование трафика), тогда как аутентификация пользователя происходит уже на уровне PPP.


config setup
    virtual_private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12 # Разрешает доступ к частным сетям через VPN (стандартные диапазоны RFC 1918)
    charondebug="ike 1, knl 1, cfg 1" # Уровень логирования (IKE-процесс, ядро, конфигурация)
    uniqueids=yes # Гарантирует уникальность идентификаторов сессий

conn %default
    ikelifetime=60m # Таймауты переключения ключей (ikelifetime, keylife)
    keylife=20m
    rekeymargin=3m
    keyingtries=1
    keyexchange=ikev1 # Используется протокол IKEv1 (обязательно для L2TP)
    authby=secret #  Аутентификация через общий ключ (PSK)

conn org-vpn
    left=%defaultroute # Локальная сторона (%defaultroute = основной шлюз системы)
    leftprotoport=17/1701 # Публичный IP VPN-сервер)
    right=185.9.84.181
    rightprotoport=17/1701
    auto=add
    type=transport
    auth=esp
    ike=aes256-sha1-modp1024
    esp=aes256-sha1-modp1024
